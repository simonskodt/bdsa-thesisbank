@page "/"

@using Entities
@using Core
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication

@* @inject Client.Service.IThesesService ThesesService *@
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject Blazored.LocalStorage.ILocalStorageService localStorage

@attribute [Authorize]


<div>
    
    <div class="row mb-5">
        <h1 class="mb-5">Find a thesis</h1>
        <NavLink href="/applications" class="top-btn bg-yellow">
            Go to applied theses
        </NavLink>
    </div>
    <div class="row">
    @foreach (var Thesis in Theses)
    {
        <ThesisComponent 
            Id="@Thesis.Id"
            Title="@Thesis.Name"
            Teacher="@Thesis.TeacherName"
            Excerpt="@Thesis.Description"
        />
    }
    </div>
</div>



@code {

    private MinimalThesisDTO[]? Theses;

    protected override async Task OnInitializedAsync()
    {

        var username = await localStorage.GetItemAsync<string>("user");
        
        var usernameInt = Int32.Parse(username);

        Theses = await Http.GetFromJsonAsync<MinimalThesisDTO[]>("api/Theses/" + usernameInt);

    }

    
}